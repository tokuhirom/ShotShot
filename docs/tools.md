# ShotShot ツール仕様

## ツール一覧

### 選択ツール（cursorarrow）
注釈の選択・移動・リサイズを行うツール。

**操作:**
- **クリック**: 注釈を選択
- **ドラッグ**: 選択中の注釈を移動
- **ハンドルをドラッグ**: 選択中の注釈をリサイズ
- **ダブルクリック（テキスト）**: テキスト編集モードに入る
- **空白部分をクリック**: 選択解除

**選択表示:**
- 選択中の注釈は青い点線の枠で囲まれる
- 四隅（矢印は両端）に白いリサイズハンドルが表示される

---

### 切り抜きツール（crop）
画像の一部を切り抜くツール。

**操作:**
- **ドラッグ**: 切り抜き領域を選択
- **適用ボタン**: 切り抜きを実行
- **キャンセルボタン**: 選択を解除

**表示:**
- 選択領域外は暗くなる
- 選択領域は白い枠線で囲まれる
- 四隅にリサイズハンドルが表示される

**注意:**
- 切り抜き後はUndo履歴がクリアされる
- 切り抜き領域外の注釈は削除される
- 領域内の注釈は座標が調整される

---

### 矢印ツール（arrow.up.right）
矢印を描画するツール。

**操作:**
- **ドラッグ**: 始点から終点に向かう矢印を描画

**スタイル:**
- 色: ツールバーで選択可能（8色 + カスタム）
- 太さ: スライダーで調整（1〜20）
- 縁取り: 白い縁取り付き（太さ × 0.8）

**矢印の形状:**
- 始点は細く、終点に向かって太くなるテーパー形状
- 終点に三角形の矢印ヘッド

---

### 四角ツール（rectangle）
四角形を描画するツール。

**操作:**
- **ドラッグ**: 対角線上の2点で四角形を描画

**スタイル:**
- 色: ツールバーで選択可能
- 太さ: スライダーで調整（1〜20）
- 縁取り: 白い縁取り付き（太さ + 4）
- 角丸/角張り: トグルボタンで切り替え（デフォルト: 角丸、radius: 8）

---

### テキストツール（textformat）
テキストを追加するツール。

**操作:**
- **クリック**: クリック位置にテキスト入力開始
- **Enter**: テキスト確定
- **フォーカス外れ**: テキスト確定（内容が失われない）
- **空のまま確定**: テキストは追加されない

**編集:**
- 選択ツールでテキストをダブルクリックすると編集モード
- 編集中にテキストを空にすると注釈が削除される

**スタイル:**
- 色: ツールバーで選択可能
- フォントサイズ: ドロップダウンで選択（16, 24, 32, 48, 64, 80, 96 pt）
- フォント: システムフォント（Bold）
- 縁取り: 白い縁取り付き（フォントサイズ × 0.08）

---

### モザイクツール（checkerboard.rectangle）
画像の一部にモザイク（ピクセル化）効果を適用するツール。

**操作:**
- **ドラッグ**: モザイク領域を選択

**表示:**
- 描画中は点線で領域を表示
- 確定後はピクセル化効果が適用される

**技術:**
- CIFilter.pixellate() を使用
- ピクセルサイズ: 領域の短辺の1/10

---

## 共通仕様

### Undo/Redo
- **⌘Z**: 操作を取り消し
- **⇧⌘Z**: 操作をやり直し
- 注釈の追加・移動・リサイズ・削除が対象
- 切り抜き後はUndo履歴がクリアされる

### キーボードショートカット
| ショートカット | 機能 |
|---------------|------|
| ⌘Z | Undo |
| ⇧⌘Z | Redo |
| ⌘C | クリップボードにコピー |
| ⌘V | クリップボードから画像を開く（新しいウィンドウ） |
| Delete | 選択中の注釈を削除 |
| Enter | 編集完了（Done） |

### 設定の永続化
以下の設定はUserDefaultsに保存され、次回起動時に復元される:
- 選択中のツール
- 選択中の色（RGBA）
- 線の太さ
- フォントサイズ
- 角丸設定

### 色プリセット
| 名前 | RGB |
|-----|-----|
| ピンク（デフォルト） | (0.98, 0.22, 0.53) |
| 赤 | (1.0, 0.23, 0.19) |
| オレンジ | (1.0, 0.58, 0.0) |
| 黄 | (1.0, 0.8, 0.0) |
| 緑 | (0.3, 0.85, 0.39) |
| 青 | (0.0, 0.48, 1.0) |
| 白 | (1.0, 1.0, 1.0) |
| 黒 | (0.0, 0.0, 0.0) |

---

## 表示仕様

### 画像表示
- 画像はウィンドウサイズに合わせて縮小表示される（拡大はしない）
- 倍率は左下のステータスバーに表示

### ウィンドウ
- 最小サイズ: 600 × 400
- 複数ウィンドウ対応（新しいウィンドウは少しずらして配置）
